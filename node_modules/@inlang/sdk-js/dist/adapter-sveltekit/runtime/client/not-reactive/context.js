import { inlangSymbol, replaceLanguageInUrl } from "../../shared/utils.js";
import { goto } from "$app/navigation";
import { page } from "$app/stores";
import { get } from "svelte/store";
import { setContext } from "svelte";
import { getRuntimeFromContext as getRuntimeFromContextShared } from "../shared/context.js";
export const getRuntimeFromContext = () => getRuntimeFromContextShared();
export const addRuntimeToContext = (runtime) => {
    const { language, referenceLanguage, languages, i, loadResource } = runtime;
    const switchLanguage = async (language) => {
        if (runtime.language === language)
            return;
        return goto(replaceLanguageInUrl(get(page).url, language), { invalidateAll: true });
    };
    setContext(inlangSymbol, {
        language,
        referenceLanguage,
        languages,
        i,
        loadResource,
        switchLanguage,
        route: route.bind(undefined, language),
    });
};
const route = (language, href) => {
    if (!href.startsWith("/"))
        return href;
    const url = `/${language}${href}`;
    return (url.endsWith("/") ? url.slice(0, -1) : url);
};
